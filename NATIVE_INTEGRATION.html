<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Native Audio Integration - audioware</title>


        <!-- Custom HTML head -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="./theme/css/mdbook-admonish.css">
        <link rel="stylesheet" href="./theme/css/mdbook-admonish-custom.css">
        <link rel="stylesheet" href="./theme/css/mdbook-admonish-styling.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="GETTING-STARTED.html"><strong aria-hidden="true">1.</strong> Getting started</a></li><li class="chapter-item expanded "><a href="CONCEPT.html"><strong aria-hidden="true">2.</strong> Concept</a></li><li class="chapter-item expanded "><a href="HOWTO.html"><strong aria-hidden="true">3.</strong> How to use?</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="MANIFEST.html"><strong aria-hidden="true">3.1.</strong> Manifest</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="SECTIONS.html"><strong aria-hidden="true">3.1.1.</strong> Sections</a></li><li class="chapter-item expanded "><a href="SETTINGS.html"><strong aria-hidden="true">3.1.2.</strong> Static Settings</a></li><li class="chapter-item expanded "><a href="ROUTING.html"><strong aria-hidden="true">3.1.3.</strong> Routing</a></li></ol></li><li class="chapter-item expanded "><a href="API.html"><strong aria-hidden="true">3.2.</strong> API</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="GUIDE.html"><strong aria-hidden="true">3.2.1.</strong> Developer guide</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="AUDIO_SYSTEM.html"><strong aria-hidden="true">3.2.1.1.</strong> AudioSystem</a></li><li class="chapter-item expanded "><a href="AUDIO_SYSTEM_EXT.html"><strong aria-hidden="true">3.2.1.2.</strong> AudioSystemExt</a></li><li class="chapter-item expanded "><a href="AUDIO_SETTINGS_EXT.html"><strong aria-hidden="true">3.2.1.3.</strong> Dynamic Settings</a></li><li class="chapter-item expanded "><a href="DYNAMIC_SOUNDS.html"><strong aria-hidden="true">3.2.1.4.</strong> Dynamic Sounds</a></li><li class="chapter-item expanded "><a href="PARAMETERS.html"><strong aria-hidden="true">3.2.1.5.</strong> Parameters</a></li><li class="chapter-item expanded "><a href="SPATIALIZATION.html"><strong aria-hidden="true">3.2.1.6.</strong> Spatialization</a></li><li class="chapter-item expanded "><a href="DYNAMIC_EMITTERS.html"><strong aria-hidden="true">3.2.1.7.</strong> Dynamic Emitters</a></li><li class="chapter-item expanded "><a href="SCENE_DIALOG_LINES.html"><strong aria-hidden="true">3.2.1.8.</strong> Scene Dialog Lines</a></li><li class="chapter-item expanded "><a href="NATIVE_INTEGRATION.html" class="active"><strong aria-hidden="true">3.2.1.9.</strong> Native Audio Integration</a></li></ol></li><li class="chapter-item expanded "><a href="DOCS.html"><strong aria-hidden="true">3.2.2.</strong> Internal docs</a></li></ol></li><li class="chapter-item expanded "><a href="INTEGRATION.html"><strong aria-hidden="true">3.3.</strong> Integration</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">audioware</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/cyb3rpsych0s1s/audioware" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="native-sounds-integration"><a class="header" href="#native-sounds-integration">Native sounds integration</a></h1>
<p>Starting from <code>1.6.0</code>, Audioware allows to listen and/or mute <em>any</em> vanilla audio event <em>at runtime</em>.</p>
<p>As a matter of fact, this means you can also <em>replace</em> any vanilla audio, including <em>temporarily</em>.</p>
<p>This also means you can find informations about any event, including the ones that lack some on <a href="https://sounddb.redmodding.org/">SoundDB</a>.</p>
<h2 id="native-audio-events-callback-system"><a class="header" href="#native-audio-events-callback-system">Native audio events callback system</a></h2>
<p>Its callback system, albeit more simplistic, is very similar to <a href="https://github.com/psiberx/cp2077-codeware/wiki#reference">Codeware's CallbackSystem</a>, so you can feel at home.</p>
<p>Both <code>RegisterCallback</code> and <code>RegisterStaticCallback</code> first parameter is the audio event <code>name</code>, which can be found in scripts, assets, or even conveniently <a href="https://sounddb.redmodding.org/">SoundDB</a>.</p>
<h3 id="register-callbacks"><a class="header" href="#register-callbacks">Register callbacks</a></h3>
<p>Let's take for examples <code>game_occlusion</code> and <a href="https://sounddb.redmodding.org/events/Mixing_Output_Cinema">Mixing_Output_Cinema</a>.</p>
<div class='codeblocks'>
<a style="font-size:12px;text-decoration:none;--fa-primary-color:tomato;color:tomato;" href="https://wiki.redmodding.org/redscript"><i style="font-size:18px;--fa-primary-color:tomato;color:tomato;" class="fa fa-solid fa-r"></i>&nbsp;&nbsp;Redscript</a>  
<pre><code class="language-swift">class MyService extends ScriptableService {
  private cb func OnLoad() {
    let system = new AudioEventCallbackSystem();
    // listen to any 'game_occlusion' audio events
    system.RegisterCallback(n"game_occlusion", this, n"OnOcclusion");
    // listen only to 'Mixing_Output_Cinema' audio events of type 'Play'
    system
        .RegisterCallback(n"Mixing_Output_Cinema", this, n"OnMixingOutput")
        .AddTarget(EventTarget.ActionType(audioEventActionType.Play));
  }

  private cb func OnOcclusion(event: ref&lt;SoundEvent&gt;) {
    FTLog("occlusion changed!");
  }

  private cb func OnMixingOutput(event: ref&lt;PlayEvent&gt;) {
    FTLog("play mixing output!");
  }
}
</code></pre>
</div>
<div id="admonition-difference-with-codeware-callback-system" class="admonition admonish-tip" role="note" aria-labelledby="admonition-difference-with-codeware-callback-system-title">
<div class="admonition-title">
<div id="admonition-difference-with-codeware-callback-system-title">
<p>Difference with Codeware callback system</p>
</div>
<a class="admonition-anchor-link" href="#admonition-difference-with-codeware-callback-system"></a>
</div>
<div>
<p>As with Codeware's, it can register callbacks to class member or static methods, filter targets to be notified about and define whether callback are automatically unregistered when a game session (by default), or persist for as long as the game runs. Audioware just does not expose additional options like <code>CallbackRunMode</code> yet.</p>
</div>
</div>
<div id="admonition-additional-considerations" class="admonition admonish-info" role="note" aria-labelledby="admonition-additional-considerations-title">
<div class="admonition-title">
<div id="admonition-additional-considerations-title">
<p>Additional considerations</p>
</div>
<a class="admonition-anchor-link" href="#admonition-additional-considerations"></a>
</div>
<div>
<p>No matter their initial type and origin, the final audio event types <em>roughly</em> match <a href="https://nativedb.red4ext.com/audioEventActionType">audioEventActionType enum</a>, but here's the twist: when the game dispatches events, they are not played directly as-is.</p>
<p>They are enqueued first, then depending on many factors happening in-game (distance from the player, velocity, number of concurrent sounds already being played, etc) they can be played, rescheduled or simply cancelled. Their fields can also change all throughout processing until final play.</p>
<ul>
<li>it's worth noting that <code>Play</code> and <code>PlayAnimation</code> events are ultimately either played from memory (a.k.a <code>play</code> from the sound engine's perspective) or from an external file (a.k.a <code>play_external</code>).</li>
<li>another type of play event exist in the sound engine but not in scripting APIs: <code>PlayOneShot</code> for short "fire and forget" sounds like weapon firing for example.</li>
<li>likewise, there's both <code>SetParameter</code> and <code>SetGlobalParameter</code> events, even if <code>SetGlobalParameter</code> is not a variant of <code>audioEventActionType</code> enum.</li>
</ul>
</div>
</div>
<p>For this reason, Audioware exposes an additional <code>enum</code> which reflects its implementation in the sound engine: <code>EventHookType</code>, which can be used when registering callbacks:</p>
<div class='codeblocks'>
<a style="font-size:12px;text-decoration:none;--fa-primary-color:tomato;color:tomato;" href="https://wiki.redmodding.org/redscript"><i style="font-size:18px;--fa-primary-color:tomato;color:tomato;" class="fa fa-solid fa-r"></i>&nbsp;&nbsp;Redscript</a>  
<pre><code class="language-swift">let system = new AudioEventCallbackSystem();
// listen to 'game_window_in_focus' global parameter event
system
    .RegisterCallback(n"game_window_in_focus", this, n"OnWindowsInFocus")
    .AddTarget(EventTarget.HookType(EventHookType.SetGlobalParameter));
</code></pre>
</div>
<div id="admonition-conversion-between-eventhooktype-and-audioeventactiontype" class="admonition admonish-info" role="note" aria-labelledby="admonition-conversion-between-eventhooktype-and-audioeventactiontype-title">
<div class="admonition-title">
<div id="admonition-conversion-between-eventhooktype-and-audioeventactiontype-title">
<p>Conversion between EventHookType and audioEventActionType</p>
</div>
<a class="admonition-anchor-link" href="#admonition-conversion-between-eventhooktype-and-audioeventactiontype"></a>
</div>
<div>
<p>Audioware conversion from <code>audioEventActionType</code> to <code>EventHookType</code> is "best effort" only.</p>
</div>
</div>
<h2 id="mute-native-audio-events"><a class="header" href="#mute-native-audio-events">Mute native audio events</a></h2>
<p>Audioware also allows to mute any native audio event.</p>
<p>Note that muted audio events <em>can still be listened to</em>.</p>
<p>For example, to completely mute Cyberpunk's intro we need:</p>
<ul>
<li><a href="https://sounddb.redmodding.org/events/cp_bumpers_temp_sfx_music_start">cp_bumpers_temp_sfx_music_start</a></li>
<li><a href="https://sounddb.redmodding.org/events/cp_intro_temp_sfx_music_start">cp_intro_temp_sfx_music_start</a></li>
<li>and <a href="https://sounddb.redmodding.org/events/cp_intro_temp_sfx_music_stop">cp_intro_temp_sfx_music_stop</a>.</li>
</ul>
<div class='codeblocks'>
<a style="font-size:12px;text-decoration:none;--fa-primary-color:tomato;color:tomato;" href="https://wiki.redmodding.org/redscript"><i style="font-size:18px;--fa-primary-color:tomato;color:tomato;" class="fa fa-solid fa-r"></i>&nbsp;&nbsp;Redscript</a>  
<pre><code class="language-swift">let manager = new AudioEventManager();
// mute 'cp_bumpers_temp_sfx_music_start' of any type
manager.Mute(n"cp_bumpers_temp_sfx_music_start");
// mute 'cp_intro_temp_sfx_music_start' of type 'Play'
manager.MuteSpecific(n"cp_intro_temp_sfx_music_start", audioEventActionType.Play);
// mute 'cp_intro_temp_sfx_music_stop' of type 'StopSound'
manager.MuteSpecific(n"cp_intro_temp_sfx_music_stop", audioEventActionType.StopSound);
</code></pre>
</div>
<div id="admonition-a-note-of-caution" class="admonition admonish-danger" role="note" aria-labelledby="admonition-a-note-of-caution-title">
<div class="admonition-title">
<div id="admonition-a-note-of-caution-title">
<p>A note of caution</p>
</div>
<a class="admonition-anchor-link" href="#admonition-a-note-of-caution"></a>
</div>
<div>
<p>Muting some audio events <em>can utterly break the game</em>, at least temporarily: it will get back to normal the next time you run the game without the mutes.</p>
<p>The most disruptive audio events are <code>SetSwitch</code>, <code>SetParameter</code> and <code>SetGlobalParameter</code>. For example, muting <code>SetSwitch</code> with <code>vo</code> audio event name will prevent dialogues audio from playing at all (but not their subtitles).</p>
<p>So experiment freely, but be careful with what you release!</p>
</div>
</div>
<h2 id="going-further"><a class="header" href="#going-further">Going further</a></h2>
<p>Here's a quick demo showing how to replace Cyberpunk intro music with a different song.</p>
<p>You can find the example's code in <code>ChangeIntro.reds</code>.</p>
<div id="admonition-youtube-demo" class="admonition admonish-youtube" role="note" aria-labelledby="admonition-youtube-demo-title">
<div class="admonition-title">
<div id="admonition-youtube-demo-title">
<p>YouTube demo</p>
</div>
<a class="admonition-anchor-link" href="#admonition-youtube-demo"></a>
</div>
<div>
<iframe width="100%" height="420" src="https://www.youtube.com/embed/0ixsBFC8Znw?si=2JF2hDpJVaUy5v0n" title="Change intro music" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
</div>
</div>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="SCENE_DIALOG_LINES.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="DOCS.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="SCENE_DIALOG_LINES.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="DOCS.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
